const questions = [
  {
    question_id: 1821,
    question_type: "yes-no",
    question_text:
      "<p><strong>Have you been diagnosed with ED by a doctor?</strong></p>",
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 1,
    highlight_colour: null,
    options: [],
    conditional: [],
    expected_answers: [],
  },
  {
    question_id: 1822,
    question_type: "multiple-selection",
    question_text:
      "<p><span>Have you ever successfully used any the following ED treatments?</span></p>",
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 0,
    highlight_colour: null,
    options: [
      "Viagra (sildenafil)",
      "Cialis (tadalafil)",
      "Levitra (vardenafil)",
      "Other (please specify)",
      "I have never used ED treatment",
    ],
    conditional: [],
    expected_answers: [],
  },
  {
    question_id: 1823,
    question_type: "no",
    question_text:
      "<p><strong>Do any of the following apply:</strong></p>\n<ul>\n<li>You have been medically advised not to have sexual intercourse or undertake rigorous exercise</li>\n<li>You have a deformity or angulation of the penis (including Peyronie&rsquo;s disease)</li>\n<li>You experience pain when getting an erection</li>\n<li>You experience pain when trying to retract your foreskin</li>\n</ul>",
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 0,
    highlight_colour: null,
    options: [],
    conditional: [],
    expected_answers: [],
  },
  {
    question_id: 1824,
    question_type: "no",
    question_text:
      "<p>Do any of the following apply?</p>\n<ul>\n<li>You have been diagnosed with diabetes or abnormal blood sugar levels</li>\n<li>In the past 5 years, you had a heart operation, stroke or heart attack</li>\n<li>You have a history of low blood pressure, fainting or, after lying down, you get dizzy when you stand up</li>\n<li>You suffer from angina, aortic stenosis, heart failure, cardiomyopathy, uncontrolled high blood pressure (more than 160/90), arrhythmia, or severe heart disease</li>\n<li>You have problems with your liver or kidneys (including kidney stones)</li>\n<li>You have an eye condition known as non-arteritic anterior ischaemic optic neuropathy, or any hereditary degenerative retinal disorders, such as retinitis pigmentosa</li>\n<li>You have a stomach or duodenal (peptic) ulcer</li>\n<li>You have a sickle cell disease or leukaemia or multiple myeloma</li>\n<li>You have a bleeding disorder, such as haemophilia</li>\n</ul>",
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 0,
    highlight_colour: null,
    options: [],
    conditional: [],
    expected_answers: [],
  },
  {
    question_id: 1825,
    question_type: "no",
    question_text:
      "<p><strong>Do you take any of the following:</strong></p>\n<ul>\n<li>a GTN spray, tablets or patches in case of chest pain or breathlessness</li>\n<li>Isosorbide mononitrate, isosorbide dinitrate or Nicorandil?</li>\n<li>Rectogesic ointment, a nitrate gel or cream</li>\n<li>Any alpha-blocker medicines such as alfuzosin, doxazosin, prazosin, tamsulosin, terazosin or the over-the-counter medicine Flomax (these are used to treat blood pressure or prostate problems)</li>\n<li>Amyl nitrate, also known as poppers, for recreational use.</li>\n</ul>",
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 0,
    highlight_colour: null,
    options: [],
    conditional: [],
    expected_answers: [],
  },
  {
    question_id: 1826,
    question_type: "yes",
    question_text:
      "<p><strong>Do you agree to seek urgent medical attention if you experience any of the following symptoms:</strong></p>\n<ul>\n<li>An erection that lasts longer than 4 hours.</li>\n<li>Blurred vision.</li>\n<li>Sudden decrease or loss of vision in one or both eyes.</li>\n<li>Chest pain.</li>\n</ul>",
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 0,
    highlight_colour: null,
    options: [],
    conditional: [],
    expected_answers: [],
  },
  {
    question_id: 1827,
    question_type: "yes",
    question_text:
      '<p>Do you understand and agree to the following:</p>\n<ul>\n<ul>\n<li style="font-weight: 400;"><span style="font-weight: 400;">I have read and agree to the Privacy Policy and Terms &amp; Conditions</span></li>\n<li style="font-weight: 400;"><span style="font-weight: 400;">I confirm that I am over 18 and this treatment is for myself and I will not provide it to, or share it with, anyone else.</span></li>\n<li style="font-weight: 400;"><span style="font-weight: 400;">I confirm that all the information that I have provided is true and I have not withheld any information that may be relevant to the prescriber\'s decision to prescribe medication.</span></li>\n<li style="font-weight: 400;"><span style="font-weight: 400;">I confirm I will read the Patient Information Leaflet provided before using any treatment.</span></li>\n<li style="font-weight: 400;"><span style="font-weight: 400;">I consent to being contacted by telephone or email should the doctor or pharmacist require further information to assess my order.</span></li>\n<li style="font-weight: 400;"><span style="font-weight: 400;">I understand the benefits &amp; risks of the treatment I have requested and confirm that I have the mental capacity to do so.</span></li>\n</ul>\n</ul>',
    question_description: "",
    error_message: "",
    helper_text: "",
    more_detail_trigger: null,
    deselect_trigger: null,
    required: 1,
    never_autofill: 0,
    never_autofill_conditions: null,
    highlight: 0,
    highlight_colour: null,
    options: [],
    conditional: [],
    expected_answers: [],
  },
];
const treatmentId = 6257;

const tipForm = document.getElementById("progress-form");
const field = document.createDocumentFragment();

const tipFormTab = document.getElementById("progress-form-tabs");
const theTab = document.createDocumentFragment();

const errorMessage =
  "Unfortunately, based on your responses we cannot provide your treatment!";

const helperText =
  "If you have not had your condition diagnosed by your doctor, it is important to have regular check-ups with your GP as ED can be a symptom of other medical conditions. You don’t need to discuss your ED with your GP if you don’t want but it’s important to have a blood pressure check and blood tests yearly to monitor your overall health.";

function startConsultancy() {
  (async () => {
    if (questions) {
      console.log(questions);
      questions.map(function (question, i) {
        let section = document.createElement("section");
        section.classList.add("pop-in");
        section.setAttribute("id", `progress-form__panel-${i + 1}`);
        section.setAttribute("role", "tabpanel");
        section.setAttribute("aria-labelledby", `progress-form__tab-${i + 1}`);
        section.setAttribute("tabindex", 0);

        if (i !== 0) {
          section.hidden = true;
        }

        tipFormTab.insertAdjacentHTML(
          "beforeend",
          `<button id="progress-form__tab-${
            i + 1
          }" class="flex-1 px-0 pt-2 progress-form__tabs-item" type="button" role="tab" aria-controls="progress-form__panel-${
            i + 1
          }" aria-selected="true">
          <span class="d-block step" aria-hidden="true">Step ${
            i + 1
          } <span class="sm:d-none">of ${question.length}</span></span>
          </button>`
        );

        if (
          question?.question_type === "yes" ||
          question?.question_type === "no" ||
          question?.question_type === "yes-no"
        ) {
          //create element and add inner html to that element
          let divButtons = document.createElement("div");
          let fieldset = document.createElement("fieldset");
          fieldset.classList.add("mt-3", "form__field", "field_wrapper");
          fieldset.setAttribute("data-question-type", question?.question_type);

          fieldset.setAttribute(
            "data-helper-text",
            question?.helper_text || helperText
          );

          fieldset.setAttribute(
            "data-error-message",
            question?.error_message || errorMessage
          );

          let legend = document.createElement("legend");
          legend.innerHTML = `${question?.question_text}`;
          divButtons.classList.add("radio-buttons");
          legend.insertAdjacentHTML(
            "afterbegin",
            '<span class="required-mark" data-required="true" aria-hidden="true"></span>'
          );
          // ;input.setAttribute("data-input-type", ${option});

          divButtons.insertAdjacentHTML(
            "beforeend",
            `<label class="form__choice-wrapper">
            <input data-input-type="yes" type="radio" name="${question?.question_id}" value="1" required>
            <span>Yes</span>
          </label>
          <label class="form__choice-wrapper">
            <input data-input-type="no" type="radio" name="${question?.question_id}" value="0">
            <span>No</span>
          </label>`
          );

          fieldset.appendChild(legend);
          fieldset.appendChild(divButtons);
          section.appendChild(fieldset);

          if (i === 0) {
            section.insertAdjacentHTML(
              "beforeend",
              `<div class="d-flex align-items-center justify-center sm:justify-end mt-4 sm:mt-5">
            <button class="button-next button-progress" type="button" data-action="next">
              Continue
            </button>
          </div>`
            );
          } else if (i === questions.length - 1) {
            section.insertAdjacentHTML(
              "beforeend",
              `<div class="d-flex flex-column-reverse sm:flex-row align-items-center justify-center sm:justify-end mt-4 sm:mt-5">
                <button type="button" class="mt-1 sm:mt-0 button--simple" data-action="prev">
                  Back
                </button>
                <button  class="button-progress" type="submit">
                  Submit
                </button>
              </div>`
            );
          } else {
            section.insertAdjacentHTML(
              "beforeend",
              `<div class="d-flex flex-column-reverse sm:flex-row align-items-center justify-center sm:justify-end mt-4 sm:mt-5">
              <button type="button" class="mt-1 sm:mt-0 button--simple button-prev" data-action="prev">
                Back
              </button>
              <button class="button-next button-progress" type="button" data-action="next">
              Continue
            </button>
          </div>`
            );
          }

          tipForm.appendChild(section);
        } else if (question?.question_type === "multiple-selection") {
          //create element and add inner html to that element
          let fieldset = document.createElement("fieldset");
          fieldset.classList.add("mt-3", "form__field", "field_wrapper");
          fieldset.setAttribute("data-question-type", "multiple-selection");
          let legend = document.createElement("legend");
          legend.innerHTML = `${question?.question_text}`;
          question?.options?.map((option) => {
            //create element
            let label = document.createElement("label");
            let span = document.createElement("span");
            let input = document.createElement("input");

            //setting attributes to the elements
            span.innerHTML = `${option}`;
            label.classList.add("form__choice-wrapper");
            input.setAttribute("type", "checkbox");
            input.setAttribute("name", `${option}`);
            input.setAttribute("value", `${option}`);
            //append child elements to the parents
            label.appendChild(input);
            label.appendChild(span);
            fieldset.appendChild(legend);
            fieldset.appendChild(label);
          });

          section.appendChild(fieldset);

          if (i === 0) {
            section.insertAdjacentHTML(
              "beforeend",
              `<div class="d-flex align-items-center justify-center sm:justify-end mt-4 sm:mt-5">
            <button class="next-button" type="button" data-action="next">
              Continue
            </button>
          </div>`
            );
          } else if (i === questions.length - 1) {
            section.insertAdjacentHTML(
              "beforeend",
              `<div class="d-flex flex-column-reverse sm:flex-row align-items-center justify-center sm:justify-end mt-4 sm:mt-5">
                <button type="button" class="mt-1 sm:mt-0 button--simple" data-action="prev">
                  Back
                </button>
                <button class="button-progress" type="submit">
                  Submit
                </button>
              </div>`
            );
          } else {
            section.insertAdjacentHTML(
              "beforeend",
              `<div class="d-flex flex-column-reverse sm:flex-row align-items-center justify-center sm:justify-end mt-4 sm:mt-5">
              <button type="button" class="mt-1 sm:mt-0 button--simple button-prev" data-action="prev">
                Back
              </button>
              <button class="button-next button-progress" type="button" data-action="next">
              Continue
            </button>
          </div>`
            );
          }

          tipForm.appendChild(section);
        } else if (question?.question_type === "text") {
          console.log("API has Text field");
        } else if (question?.question_type === "textarea") {
          console.log("API has Textarea field");
        } else {
          console.log("No field matches");
        }
      });

      tipForm.insertAdjacentHTML(
        "beforeend",
        `<section id="progress-form__thank-you" hidden>
        <p>Consultancy data has been submitted successfully!</p>
        <p>Next, you are going to tell us more about your personal and medical condition.</p>
      </section>`
      );
    } else {
      console.log("Something went wrong with TIP API");
      console.log(response);
    }
    // tipForm.appendChild(field);
  })();
}

startConsultancy();
